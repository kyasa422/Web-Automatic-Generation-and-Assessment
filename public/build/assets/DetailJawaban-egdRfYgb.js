import{q as L,r as b,W as O,j as e}from"./app-CAzukakE.js";import{D as J}from"./DefaultLayout-D-u9IMfp.js";import{G as v}from"./index-COzIZR3u.js";import{c as _,b as S}from"./index-CnZJ4sI3.js";import{h as $}from"./moment-C5S46NFB.js";import{S as j}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{R}from"./index-9iYiI23Q.js";import{c as D,C as K,a as Y}from"./circle-x-BjHoSwY1.js";import"./index-Dnqp_Y-n.js";/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],W=D("sparkles",H),re=()=>{const{ulanganSettings:p,env:{MODEL_API_URL:q}}=L().props,[u,m]=b.useState(null),[h,M]=b.useState(null),[y,N]=b.useState(null),{data:c,setData:x,errors:z,processing:U,post:I}=O({nilai:null,ulangan_setting_id:p.id,user_id:p.ulangan_jawaban_has_one.user.id,detail:p.ulangan_jawaban_many.map(s=>({questionId:s.question_inquiry_id,question:s.question_inquiry.question,answer:s.question_inquiry.answer,studentAnswer:s.answer,bobot:s.question_inquiry.bobot,multipleChoice:s.question_inquiry.multiple_choice,isCorrect:null,note:null,score:null,label:s.question_inquiry.label}))});console.log(p);const k=c.detail.reduce((s,a)=>s+(a.score!=null?a.score*a.bobot:0),0);c.detail.reduce((s,a)=>s+(a.bobot??1),0);const A=async s=>{const a=c.detail[s];m(`COSINE_${s}`);try{const t=await fetch(`${q}/score`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({answer_student:a.studentAnswer,answer_key:a.answer})});if(!t.ok)throw new Error("Gagal menilai");const n=await t.json(),l=.3,r=n.filtered_cosine_similarity??0,d=r>=l?r:0,o=await G({studentAnswer:a.studentAnswer,answerKey:a.answer,cosine:r}),i=[...c.detail],g=i[s].bobot??1;i[s].score=d,i[s].finalScore=d*g,i[s].isCorrect=d>.5,i[s].note=o;const f=i.reduce((w,P)=>w+(P.finalScore??0),0);x(w=>({...w,detail:i,nilai:f==null?void 0:f.toFixed(2)}))}catch(t){console.error("Error scoring:",t),alert("Gagal menilai jawaban")}m(null)},G=async({studentAnswer:s,answerKey:a,cosine:t})=>{const n=new v({apiKey:"AIzaSyBfeeUiCYcPR_xkHGCPshe2GnN7c_Exd7Y"}),l={type:"object",properties:{note:{type:"string",description:"Berikan masukan atau saran terhadap jawaban siswa dalam bahasa Indonesia"}},required:["note"]},r=await n.models.generateContent({model:"gemini-2.0-flash",contents:[{role:"user",parts:[{text:`Buatlah saran atau catatan untuk jawaban siswa berikut:


                            Jawaban Siswa: "${s}"
Kunci Jawaban: 
                            "${a}"
Skor Cosine Similarity: ${t==null?void 0:t.toFixed(4)}


                            Berikan catatan singkat dalam bahasa Indonesia.`}]}],config:{responseMimeType:"application/json",responseSchema:l}});return JSON.parse(r.text).note||"Tidak ada catatan."},B=async()=>{m("CORRECT_GEMINI");try{const s=new v({apiKey:"AIzaSyBfeeUiCYcPR_xkHGCPshe2GnN7c_Exd7Y",generationConfig:{temperature:0,topP:.95,topK:1,maxOutputTokens:8192,responseMimeType:"application/json"}}),a=c.detail.map(o=>({questionId:o.questionId,question:o.question,correctAnswer:o.answer,studentAnswer:o.studentAnswer})),t={type:"object",properties:{response:{type:"array",items:{type:"object",properties:{question_id:{type:"string"},isCorrect:{type:"boolean",description:"Mark the correct answer if the score is more than 0.5"},score:{type:"number",description:"score range from 0.0 to 1.0"},note:{type:"string",description:"Give advice on students' answers in Indonesian"}},required:["question_id","isCorrect","score","note"]}}}},n=await s.models.generateContent({model:"gemini-2.0-flash",contents:JSON.stringify(a),config:{responseMimeType:"application/json",responseSchema:t}}),l=JSON.parse(n.text),r=[...c.detail];l.response.map(o=>{const i=r.findIndex(g=>g.questionId===o.question_id);if(i>-1){const g=r[i].bobot??1;r[i].isCorrect=o.isCorrect,r[i].score=o.score,r[i].note=o.note,r[i].finalScore=o.score*g}});const d=r.reduce((o,i)=>o+(i.finalScore??0),0);x(o=>({...o,detail:r,nilai:d==null?void 0:d.toFixed(2)})),console.log("berhasil",l.response)}catch(s){console.error(s),alert("Ada kesalahan pada server!")}m(null)},C=(s,a)=>{const t=[...c.detail];t[s].isCorrect=a,x(n=>({...n,detail:t}))},T=(s,a)=>{const t=[...c.detail];t[s].note=a.length==0?"Tanpa Catatan":a,x(n=>({...n,detail:t}))},E=(s,a)=>{const t=[...c.detail],n=t[s].bobot??1,l=parseFloat(a);t[s].score=l,t[s].finalScore=l*n,t[s].isCorrect=l>.5;const r=t.reduce((d,o)=>d+(o.finalScore??0),0);x(d=>({...d,detail:t,nilai:r==null?void 0:r.toFixed(2)}))},F=()=>{m("SUBMIT");const s=setTimeout(()=>{m(null),j.fire({icon:"error",title:"Gagal",text:"Gagal menyimpan penilaian! Waktu habis (10 detik). Silakan coba lagi."})},1e4);I(route("assessments.store"),{onSuccess:()=>{clearTimeout(s),m(null),j.fire({icon:"success",title:"Berhasil",text:"Penilaian berhasil disimpan!"})},onError:a=>{clearTimeout(s),m(null),console.error(a),j.fire({icon:"error",title:"Gagal",text:"Gagal menyimpan penilaian!"})}})};return b.useEffect(()=>{console.log(h)},[h]),e.jsx(J,{children:e.jsxs("div",{className:"p-6 max-w-5xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-6",children:"Detail Jawaban Siswa"}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6 border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-800",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Nama Siswa:"})," ",p.ulangan_jawaban_has_one.user.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Mata Pelajaran:"})," ",p.question.subject.name]}),e.jsxs("p",{children:[e.jsxs("span",{className:"font-semibold",children:["Tanggal Dikerjakan :"," "]}),$(p.ulangan_jawaban_has_one.created_at).format("DD MMMM YYYY HH:mm")]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-1",children:"Nilai Otomatis:"}),e.jsx("div",{className:"mt-2 flex flex-col gap-2",children:e.jsxs("button",{className:"btn btn-sm btn-outline",style:{borderColor:"#5C6BC0",color:"#5C6BC0"},disabled:u!=null,onClick:B,children:[u==="CORRECT_GEMINI"?e.jsx("span",{className:"loading loading-spinner loading-xs mr-2"}):e.jsx(W,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:"Koreksi semua soal menggunakan Ai"})]})})]})]})]})}),c.detail.length>0?c.detail.map((s,a)=>{var t;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl shadow-md p-6 mb-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between flex-wrap gap-4 items-center bg-sky-100 text-sky-800 px-5 py-3 rounded-xl",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"font-semibold text-lg",children:["Soal ",a+1]}),e.jsxs("p",{className:"text-sm",children:["Bobot:"," ",e.jsx("span",{className:"font-semibold",children:s.bobot})]})]}),e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{children:"Skor :"}),y===a?e.jsx("input",{type:"number",step:"0.01",min:0,max:1,className:"input input-sm border rounded w-20 text-right",defaultValue:s.score??0,onBlur:n=>{const l=parseFloat(n.target.value);if(isNaN(l)||l<0||l>1){j.fire({icon:"error",title:"Skor tidak valid",text:"Masukkan nilai antara 0 dan 1."}),n.target.value=s.score??0;return}E(a,l),N(null)}}):e.jsx("span",{className:"font-semibold",children:s.score!==null?(t=s.score)==null?void 0:t.toFixed(2):"Belum ada"}),e.jsx("button",{className:"btn btn-sm btn-ghost hover:bg-gray-100 rounded-full",onClick:()=>N(y===a?null:a),children:y===a?e.jsx(_,{}):e.jsx(S,{})})]}),e.jsxs("p",{className:"text-sm mt-1",children:["Nilai:",e.jsx("span",{className:"font-semibold ml-1",children:s.score!==null?(s.bobot*s.score).toFixed(2):"Belum ada"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[s.multipleChoice.length===0&&e.jsx("button",{type:"button",onClick:()=>A(a),disabled:u===`COSINE_${a}`,className:"btn btn-sm flex items-center gap-2 border border-sky-300 bg-sky-50 text-sky-700 hover:bg-sky-100 transition rounded-full px-4 py-1 disabled:opacity-50",children:u===`COSINE_${a}`?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 text-sky-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]}),e.jsx("span",{children:"Loading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"text-lg"}),e.jsx("span",{children:"Koreksi soal ini dengan Ai"})]})}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:`multiple-${a}`,className:"hidden",checked:s.isCorrect===!0,onChange:()=>C(a,!0)}),e.jsxs("div",{className:`flex items-center gap-1 px-3 py-1 rounded-full border text-sm transition ${s.isCorrect===!0?"bg-green-100 border-green-500 text-green-700":"border-gray-300 text-gray-500"}`,children:[e.jsx(K,{className:"w-4 h-4"}),"Benar"]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:`multiple-${a}`,className:"hidden",checked:s.isCorrect===!1,onChange:()=>C(a,!1)}),e.jsxs("div",{className:`flex items-center gap-1 px-3 py-1 rounded-full border text-sm transition ${s.isCorrect===!1?"bg-red-100 border-red-500 text-red-700":"border-gray-300 text-gray-500"}`,children:[e.jsx(Y,{className:"w-4 h-4"}),"Salah"]})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-800",children:e.jsx("strong",{children:"Pertanyaan:"})}),e.jsx("p",{className:"text-gray-700",children:s.question})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-800",children:e.jsx("strong",{children:"Jawaban Siswa:"})}),e.jsx("p",{className:"text-gray-700",children:s.studentAnswer})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-800 font-semibold",children:s.multipleChoice.length===0?"Kunci Jawaban Essay:":"Kunci Jawaban PG:"}),e.jsxs("ul",{className:"list-disc pl-5 text-gray-700",children:[s.answer&&typeof s.answer=="string"&&e.jsx("li",{children:s.answer}),s.multipleChoice.map((n,l)=>e.jsxs("li",{className:n.isCorrect==1?"text-green-600 font-semibold":"",children:[n.text," ",n.isCorrect==1?"(Benar)":""]},l))]})]}),s.note&&s.multipleChoice.length==0&&e.jsxs("div",{className:"mt-2 flex justify-between items-start gap-4",children:[h==a?e.jsx("textarea",{className:"textarea textarea-bordered w-full rounded-md border border-gray-300 p-2 text-gray-700",defaultValue:s.note,onChange:n=>T(a,n.currentTarget.value)}):e.jsxs("div",{children:[e.jsx("strong",{className:"text-gray-800",children:"Catatan:"}),e.jsx("p",{className:"text-gray-700",children:s.note})]}),e.jsx("button",{className:"btn btn-sm btn-ghost hover:bg-gray-100 rounded-full",onClick:()=>M(h===a?null:a),children:h===a?e.jsx(_,{}):e.jsx(S,{})})]})]},a)}):e.jsx("p",{className:"text-red-500 text-center",children:"Tidak ada data jawaban ditemukan."}),c.detail.length>0&&e.jsxs("div",{className:" p-6 bg-slate-50 border border-blue-200 rounded-lg shadow-inner text-green-800 text-lg font-semibold text-center",children:["Total Nilai Akhir: ",k?parseFloat(k).toFixed(2):0," dari 100",e.jsx("button",{className:"btn btn-md btn-ghost bg-blue-500 text-white ml-5 gap-2",onClick:F,disabled:u!==null,children:u==="SUBMIT"?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]}),"Menyimpan..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),"Simpan Penilaian"]})})]})]})})};export{re as default};
