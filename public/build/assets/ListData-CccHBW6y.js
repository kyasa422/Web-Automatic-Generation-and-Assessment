import{q as T,r as q,j as e,y as A}from"./app-B5i_3rpD.js";import{b as x,c as B,a as F}from"./index-y11xsRMH.js";import{R as L}from"./index-CvDUOjs0.js";import{u as i}from"./store-Bu7jhjlc.js";import{l as j}from"./lodash-GL38uJaz.js";import{w as G}from"./sweetalert2-react-content.es-Dh1wk6Nb.js";import{S as _}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{G as $}from"./index-COzIZR3u.js";const z=()=>{const{env:{GEMINI_API_KEY:g,GEMINI_MODEL_NAME:R},subject:y}=T().props,[a,c]=q.useState(null),l=i(t=>t.response),u=i(t=>t.updateResponseByIndex),m=i(t=>t.request),f=i(t=>t.deleteResponse),o=i(t=>t.isLoading),d=i(t=>t.setIsLoading),N=i(t=>t.reset),h=G(_),p=t=>{const{name:s,value:n}=t.target,r=j.cloneDeep(a);j.set(r,s,n),c(r)},w=t=>{const s={...a},n=s.multipleChoice.findIndex(r=>r.isCorrect==!0);n!=-1&&(s.multipleChoice[n].isCorrect=!1),s.multipleChoice[t].isCorrect=!0,c(s)},b=t=>{a!=null&&a.index==t?(u(t,a),c(null)):c({index:t,...l[t]})},C=()=>{l.map(s=>parseFloat(s.weight)).reduce((s,n)=>s+n).toFixed(2)!=100?h.fire({icon:"warning",title:"Bobot tidak sesuai",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3}):A.post(route("guru.generated-soal.store"),{...m,response:l},{onStart:()=>d("SUBMIT"),onSuccess:()=>{N(),h.fire({icon:"success",title:"Soal berhasil disimpan",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})},onFinish:()=>d(null)})},S=async(t,s)=>{try{d(`SINGLE-${t}`);const n=new $({apiKey:g}),r=y.find(E=>E.id==m.subject).name,k=s==="ESSAY"?{type:"object",properties:{question:{type:"string"},answer:{type:"string"},answerType:{type:"string",enum:["ESSAY"]},label:{type:"string",enum:["uraian_terbatas","uraian_bebas"]}},required:["question","answer","answerType","label"]}:{type:"object",properties:{question:{type:"string"},answerType:{type:"string",enum:["MULTIPLE_CHOICE"]},multipleChoice:{type:"array",items:{type:"object",properties:{text:{type:"string"},isCorrect:{type:"boolean"}},required:["text","isCorrect"]},minItems:4,maxItems:4}},required:["question","answerType","multipleChoice"]},v=`Buatkan 1 soal berdasarkan parameter berikut:
- class: ${m.class}
- subject: ${r}
- type: ${m.type===0?"Ulangan Tengah Semester":"Ulangan Akhir Semester"}
- answerType: ${s}

${s==="ESSAY"?"Untuk soal essay, wajib menyertakan atribut label dengan nilai 'uraian_terbatas' atau 'uraian_bebas'.":"Untuk soal pilihan ganda, wajib ada 4 opsi dan satu jawaban benar."}
Jawaban harus dalam format JSON murni, hanya 1 soal, tidak kurang tidak lebih.`,I=(await n.models.generateContent({contents:v,model:"gemini-2.5-flash",config:{responseMimeType:"application/json",responseSchema:k,temperature:.7}})).text;u(t,JSON.parse(I))}catch(n){console.error(n)}finally{d(null)}};return e.jsx("div",{className:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark",children:o==="ALL"?e.jsx("h1",{className:"p-6 font-semibold text-center",children:"Soal sedang dimuat harap ditunggu..."}):l.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-b border-stroke px-6.5 py-4 dark:border-strokedark",children:[e.jsx("h3",{className:"font-medium text-black dark:text-white",children:"Hasil Generate Soal"}),e.jsxs("div",{className:"mt-2 text-right",children:[e.jsx("strong",{children:"Total Bobot: "}),e.jsxs("span",{className:"text-red-400",children:[l.map(t=>parseFloat(t.weight)).reduce((t,s)=>t+s,0).toFixed(2),"/100"]})]})]}),l.map((t,s)=>e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"border p-6 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"font-bold",children:["Soal ",s+1," ",t.label==="uraian_terbatas"?"":null]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",className:"btn btn-circle btn-sm btn-ghost",onClick:()=>b(s),children:a==null||a.index!=s?e.jsx(x,{}):e.jsx(B,{})}),e.jsx("button",{type:"button",className:"btn btn-circle btn-sm btn-ghost",disabled:o!=null,onClick:()=>S(s,t.answerType),children:o==`SINGLE-${s}`?e.jsx("div",{className:"loading"}):e.jsx(L,{})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[e.jsxs("span",{children:["Bobot: ",t.weight?parseFloat(t.weight).toFixed(2):0]}),a&&a.index==s?e.jsx("input",{type:"number",className:"input input-bordered input-sm w-16",name:"weight",value:a.weight,onChange:p}):e.jsx("button",{className:"btn btn-sm btn-ghost btn-circle",onClick:()=>b(s),children:e.jsx(x,{size:10})})]}),e.jsx("button",{type:"button",className:"btn btn-circle btn-sm btn-error text-white",onClick:()=>f(s),children:e.jsx(F,{})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"font-medium mb-1",children:[e.jsx("span",{children:"Pertanyaan:"}),a!=null&&a.index==s?e.jsx("input",{type:"text",className:"input input-bordered input-sm w-full",value:a.question,name:"question",onChange:p}):e.jsx("span",{className:"font-normal",children:t.question})]}),t.answerType==="ESSAY"?a!=null&&a.index==s?e.jsx("textarea",{type:"text",className:"textarea textarea-bordered textarea-sm w-full rounded-xl",name:"answer",onChange:p,value:a.answer}):e.jsxs("p",{className:"font-medium",children:["Jawaban: ",e.jsx("span",{className:"font-normal",children:t.answer})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium mb-1",children:"Pilihan:"}),e.jsx("ul",{className:"list-disc ml-6",children:t.multipleChoice.map((n,r)=>e.jsx("li",{className:`${n.isCorrect?"text-green-600":""}`,children:a!=null&&a.index===s?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"input input-bordered input-sm",name:`multipleChoice.${r}.text`,value:a.multipleChoice[r].text,onChange:p}),e.jsx("input",{type:"radio",name:"isCorrect",checked:a.multipleChoice[r].isCorrect,onChange:()=>w(r)})]}):e.jsxs("p",{children:[n.text," ",n.isCorrect?"(Jawaban Benar)":null]})},r))})]})]})]})},s)),o==="ADD"?e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"loading"})}):null,e.jsx("div",{className:"flex justify-end mt-5 p-6",children:e.jsxs("button",{className:"btn btn-primary",disabled:o!=null,onClick:C,children:[o=="SUBMIT"?e.jsx("div",{className:"loading"}):null,e.jsx("span",{children:"Simpan Soal"})]})})]}):e.jsx("h1",{className:"font-semibold text-xl text-center p-10",children:"Belum ada soal yang dimuat!"})})};export{z as default};
