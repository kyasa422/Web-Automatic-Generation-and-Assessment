import{q as V,r as d,W,R as X,j as e}from"./app-BS3kFj9k.js";import{D as z}from"./DefaultLayout-VcBb6i6U.js";import{l as Z}from"./index-DKvkNito.js";import{G as ee}from"./index-DiWJTiuy.js";import{G as ae}from"./index-COzIZR3u.js";import{c as A,d as G}from"./index-80BA85Jk.js";import{R as U}from"./index-BtZHA0RH.js";import{S as te}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{w as se}from"./sweetalert2-react-content.es-Cycse6xU.js";import"./index-BnOs0bKj.js";const he=()=>{const{subject:h}=V().props,j=se(te),C="AIzaSyBfeeUiCYcPR_xkHGCPshe2GnN7c_Exd7Y",[o,M]=d.useState({kelas:"",mapel:"",tingkat:"",jumlahSoalEsai:"",jumlahSoalPG:"",bahasa:"indonesia",tingkatPendidikan:"vocational high school",kesulitan:"MEDIUM"}),[B,f]=d.useState(null),[w,F]=d.useState(null),[E,b]=d.useState(""),[g,P]=d.useState(!1),[k,T]=d.useState(null),[x,R]=d.useState(null),{data:c,setData:u,post:q,processing:I}=W({response:[],classLevel:"",subjectId:"",examLevel:!1}),[L,J]=d.useState(null),[v,O]=d.useState(0);X.useEffect(()=>{const s=c.response.reduce((a,n)=>a+parseFloat(n.bobot||0),0);O(s)},[c.response]);function p(s){const{name:a,value:n}=s.target;if(a==="tingkat"&&(n==="ulangan tengah semester"?u("examLevel",!1):u("examLevel",!0)),a==="mapel"){const t=h.find(i=>i.id===n);t&&u("subjectId",t.id)}a==="kelas"&&u("classLevel",parseInt(n)-9),M(t=>({...t,[a]:n}))}const D=async s=>{const a=s.target.files[0];if(a){if(F(a),a.type==="application/pdf")b("PDF parsing not implemented in this example");else if(a.type==="application/vnd.openxmlformats-officedocument.wordprocessingml.document"||a.type==="application/msword"){const n=new FileReader;n.onload=async t=>{const i=t.target.result;try{const l=await Z.extractRawText({arrayBuffer:i});b(l.value)}catch(l){console.error("Error parsing document:",l),b("Error parsing document")}},n.readAsArrayBuffer(a)}else if(a.type==="text/plain"){const n=new FileReader;n.onload=t=>{b(t.target.result)},n.readAsText(a)}}};function H(s){let a=s.replace(/[“”]/g,'"');return a=a.replace(/[^\x20-\x7E\n\r\t]+/g,""),a}const Y=async s=>{s.preventDefault(),P(!0);try{try{const n=new ee(C).getGenerativeModel({model:"tunedModels/dataset-fine-tune-e6dw24pc7u1j9p49csht7a",generationConfig:{temperature:1,topP:.95,topK:40,maxOutputTokens:8192,responseMimeType:"text/plain"}});let t=`{
                    "subject": "${h.find(r=>r.id===o.mapel).name}",
                    "classLevel": ${o.kelas},
                    "educationLevel": "vocational high school",
                    "numberOfQuestion": ${o.jumlahSoalEsai||0},
                    "multipleChoiceCount": ${o.jumlahSoalPG||0},
                    "language": "indonesia",
                    "questionDifficultyLevel": "${o.kesulitan}",
                    "type": ["ESSAY", "MULTIPLE_CHOICE"],
                    "level": "${o.tingkat}"
                }`;E&&(t+=`

Materi: ${E.substring(0,1e3)}`),t+=`

Buatlah soal dalam dua jenis: ESSAY dan MULTIPLE CHOICE.

- Jumlah soal ESSAY: \${data.jumlahSoalEsai}
- Jumlah soal MULTIPLE CHOICE: \${data.jumlahSoalPG}

Instruksi penting:
1. Generate soal ESSAY terlebih dahulu, baru kemudian soal MULTIPLE CHOICE.
2. Setiap soal memiliki bobot lebih dari 0, dan total bobot dari semua soal (ESSAY + MULTIPLE CHOICE) harus tepat 100.
3. Untuk setiap soal MULTIPLE CHOICE, berikan 4 pilihan jawaban:
   - Tepat 1 jawaban benar (isCorrect: true)
   - Dan 3 jawaban salah (isCorrect: false)

Format output harus berupa array JSON dengan struktur sebagai berikut:

Untuk soal ESSAY:
{
  "type": "ESSAY",
  "question": "Pertanyaannya apa?",
  "answer": "Jawaban model yang benar"
}

Untuk soal MULTIPLE CHOICE:
{
  "type": "MULTIPLE_CHOICE",
  "question": "Pertanyaannya apa?",
  "multipleChoice": [
    { "text": "Pilihan A", "isCorrect": true },
    { "text": "Pilihan B", "isCorrect": false },
    { "text": "Pilihan C", "isCorrect": false },
    { "text": "Pilihan D", "isCorrect": false }
  ]
}

Semua soal (ESSAY dan MULTIPLE CHOICE) harus dimasukkan ke dalam satu array "response".`;const l=await(await n.generateContent(t)).response.text();console.log("Raw response:",l);try{const r=H(l),m=r.indexOf("{"),S=r.lastIndexOf("}")+1,N=r.slice(m,S),_=JSON.parse(N);u("response",_.response)}catch(r){console.error("Error parsing JSON:",r),f({error:"Failed to parse JSON from response",raw:l})}}catch(a){console.error("Error parsing JSON response:",a),f({error:"Failed to parse response",raw:responseText})}}catch(a){console.error("Generation error:",a),f({error:"Failed to generate content"})}finally{P(!1)}},$=async s=>{T(s);try{let a={subject:h.find(m=>m.id===o.mapel).name,classLevel:o.kelas,educationLevel:"vocational high school",language:"indonesia",questionDifficultyLevel:o.kesulitan},n;c.response[s].type==="ESSAY"?n={type:"object",properties:{question:{type:"string"},answer:{type:"string"}},required:["question","answer"]}:(a={...a,totalNumberOfMultipleChoice:4},n={type:"object",properties:{question:{type:"string"},multipleChoice:{type:"array",items:{type:"object",properties:{isCorrect:{type:"boolean"},text:{type:"string"}},required:["isCorrect","text"]}}},required:["question","multipleChoice"]});const i=await new ae({apiKey:C}).models.generateContent({model:"gemini-2.0-flash",contents:JSON.stringify(a),config:{responseMimeType:"application/json",responseSchema:n}}),l=JSON.parse(i.text),r={...c};r.response[s]={type:c.response[s].type,...l},u(r)}catch(a){console.error(a),alert("Gagal generate ulang")}T(null)},y=(s,a,n)=>{const t={...c};if(n==="QUESTION")t.response[a].question=s;else if(n==="ANSWER")t.response[a].answer=s;else if(n==="BOBOT"){const l=parseFloat(s||0),r=t.response.reduce((m,S,N)=>N===a?m:m+parseFloat(S.bobot||0),0);if(r+l>100){j.fire({icon:"error",title:"Total bobot melebihi 100",text:`Bobot saat ini: ${r}, bobot baru akan menjadi: ${r+l}`});return}t.response[a].bobot=l}const i=t.response.reduce((l,r)=>l+parseFloat(r.bobot||0),0);O(i),u(t)},Q=(s,a,n)=>{const t={...c};t.response[a].multipleChoice[n].text=s,u(t)},K=()=>{const s=c.response.reduce((a,n)=>a+parseFloat(n.bobot||0),0);if(s!==100){j.fire({icon:"error",title:"Total bobot harus tepat 100!",text:`Saat ini total bobot adalah ${s}. Mohon sesuaikan.`,toast:!0,position:"top-end",showConfirmButton:!1,timer:4e3});return}q(route("guru.generated-soal.store"),{onSuccess:()=>{j.fire({icon:"success",title:"Berhasil menambahkan soal",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})}})};return e.jsx(z,{children:e.jsxs("div",{className:"flex flex-col gap-9",children:[e.jsxs("div",{className:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark",children:[e.jsx("div",{className:"border-b border-stroke px-6.5 py-4 dark:border-strokedark",children:e.jsx("h3",{className:"font-medium text-black dark:text-white",children:"Generate Soal Ujian"})}),e.jsx("form",{onSubmit:Y,children:e.jsxs("div",{className:"p-6.5",children:[e.jsxs("div",{className:"mb-4.5",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",children:"Jumlah Soal Esai"}),e.jsxs("select",{className:"select select-bordered w-full",value:o.jumlahSoalEsai,onChange:p,name:"jumlahSoalEsai",children:[e.jsx("option",{value:"",disabled:!0,selected:!0,children:"Pilih jumlah soal esai"}),e.jsx("option",{value:"0",children:"0"}),e.jsx("option",{value:"5",children:"5"}),e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"15",children:"15"}),e.jsx("option",{value:"20",children:"20"})]})]}),e.jsxs("div",{className:"mb-4.5",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",children:"Jumlah Soal Pilihan Ganda"}),e.jsxs("select",{className:"select select-bordered w-full",value:o.jumlahSoalPG,onChange:p,name:"jumlahSoalPG",children:[e.jsx("option",{value:"",disabled:!0,selected:!0,children:"Pilih jumlah soal pilihan ganda"}),e.jsx("option",{value:"0",children:"0"}),e.jsx("option",{value:"5",children:"5"}),e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"15",children:"15"}),e.jsx("option",{value:"20",children:"20"})]})]}),e.jsxs("div",{className:"mb-4.5",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",children:"Upload Materi (PDF/Docx/Txt)"}),e.jsx("input",{type:"file",accept:".pdf,.docx,.doc,.txt",onChange:D,className:"w-full rounded-lg border-[1.5px] border-stroke bg-transparent px-5 py-3 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary"}),w&&e.jsxs("p",{className:"mt-2 text-sm text-gray-500",children:["File terunggah: ",w.name]})]}),e.jsxs("div",{className:"mb-4.5",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",children:"Kelas"}),e.jsxs("select",{className:"select select-bordered w-full",value:o.kelas,onChange:p,name:"kelas",children:[e.jsx("option",{value:"",disabled:!0,selected:!0,children:"Pilih Kelas"}),e.jsx("option",{value:"10",children:"X (Sepuluh)"}),e.jsx("option",{value:"11",children:"XI (Sebelas)"}),e.jsx("option",{value:"12",children:"XII (Duabelas)"})]})]}),e.jsxs("div",{className:"mb-4.5",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",children:"Mata Pelajaran"}),e.jsxs("select",{className:"select select-bordered w-full",value:o.mapel,onChange:p,name:"mapel",children:[e.jsx("option",{value:"",disabled:!0,selected:!0,children:"Pilih Mata Pelajaran"}),h.map((s,a)=>e.jsx("option",{value:s.id,children:s.name},a))]})]}),e.jsxs("div",{className:"mb-4.5",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",children:"Tingkat Ujian"}),e.jsxs("select",{className:"select select-bordered w-full",value:o.tingkat,onChange:p,name:"tingkat",children:[e.jsx("option",{value:"",disabled:!0,selected:!0,children:"Pilih Tingkatan"}),e.jsx("option",{value:"ulangan tengah semester",children:"Ulangan Tengah Semester"}),e.jsx("option",{value:"ulangan akhir semester",children:"Ulangan Akhir Semester"})]})]}),e.jsx("button",{type:"submit",disabled:g,className:"flex w-full justify-center rounded bg-primary p-3 font-medium text-gray hover:bg-opacity-90 disabled:bg-opacity-50",children:g?"Generating...":"Generate Soal"})]})})]}),e.jsxs("div",{className:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark",children:[e.jsx("div",{className:"border-b border-stroke px-6.5 py-4 dark:border-strokedark",children:e.jsxs("h3",{className:"font-medium text-black dark:text-white",children:["Hasil Generate Soal",e.jsxs("div",{className:"mb-4 text-right",children:[e.jsx("strong",{children:"Total Bobot: "}),e.jsx("span",{style:{color:v>100?"red":v===100?"green":"orange"},children:v}),"/ 100"]})]})}),e.jsx("div",{className:"p-6.5",children:g?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{className:"mt-4",children:"Generating questions..."})]}):c.response.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[c.response.map((s,a)=>{var n;return e.jsxs("div",{className:"border p-4 rounded-lg",children:[e.jsx("h3",{className:"font-bold mb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:["Soal ",a+1," (",s.type==="ESSAY"?"Esai":"Pilihan Ganda",")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-circle btn-sm btn-ghost",onClick:()=>R(t=>t===a?null:a),children:x!=a?e.jsx(A,{}):e.jsx(G,{})}),e.jsx("button",{type:"button",className:"btn btn-circle btn-sm btn-ghost",onClick:()=>$(a),disabled:k!=null,children:k!=null?k===a?e.jsx("div",{className:"loading"}):e.jsx(U,{}):e.jsx(U,{})}),e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Bobot:"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[L!==a?e.jsx("span",{children:s.bobot??1}):e.jsx("input",{type:"number",min:"1",className:"input input-sm input-bordered w-24",onChange:t=>y(t.currentTarget.value,a,"BOBOT"),defaultValue:s.bobot??1}),e.jsx("button",{type:"button",className:"btn btn-circle btn-sm btn-ghost",onClick:()=>J(t=>t===a?null:a),children:L!==a?e.jsx(A,{}):e.jsx(G,{})})]})]})]})]})}),e.jsxs("p",{className:"mb-2",children:[e.jsx("span",{className:"font-medium",children:"Pertanyaan:"})," ",x!=a?e.jsx("span",{children:s.question}):e.jsx("input",{className:"input input-sm input-bordered w-full",onChange:t=>y(t.currentTarget.value,a,"QUESTION"),defaultValue:s.question})]}),s.type==="MULTIPLE_CHOICE"&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"font-medium mb-1",children:"Pilihan:"}),e.jsx("ul",{className:"list-disc ml-6",children:(n=s.multipleChoice)==null?void 0:n.map((t,i)=>e.jsxs("li",{className:t.isCorrect?"text-green-600 font-medium":"",children:[x!=a?t.text:e.jsx("input",{className:"input input-sm input-bordered w-full",onChange:l=>Q(l.currentTarget.value,a,i),defaultValue:t.text})," ",t.isCorrect&&"(Jawaban Benar)"]},i))})]}),s.type==="ESSAY"?e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Jawaban:"})," ",x!=a?e.jsx("span",{children:s.answer}):e.jsx("input",{className:"input input-sm input-bordered w-full",onChange:t=>y(t.currentTarget.value,a,"ANSWER"),defaultValue:s.answer})]}):null]},a)}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:K,disabled:I,children:[I?e.jsx("div",{className:"loading"}):null,e.jsx("span",{children:"Simpan"})]})})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Raw JSON Response:"}),e.jsx("pre",{className:"bg-gray-100 p-4 rounded overflow-auto  dark:bg-gray-800 dark:text-gray-200",children:JSON.stringify(B,null,2)})]})]}):e.jsx("p",{className:"text-center py-8 text-gray-500",children:"Hasil generate soal akan ditampilkan di sini"})})]})]})})};export{he as default};
